<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>View Compassionate Application</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" th:href="@{/styles/navbar.css}">
  <link rel="stylesheet" th:href="@{/styles/main.css}">
</head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>
<div class="container">
  <div class="card animated-card p-4">
    <h2 class="section-heading">Compassionate Application Review</h2>

    <div>
      <p><strong>Application Type:</strong> <span th:text="${app.applicationType}"></span></p>
      <p><strong>Reason:</strong></p>
      <pre th:text="${app.reason}"></pre>
      <p><strong>Status:</strong> <span th:text="${app.status}"></span></p>
      <p><strong>Submission Date:</strong> <span th:text="${app.submissionDate}"></span></p>
    </div>

    <div class="mt-4">
      <h5 class="section-heading">Missed Exams</h5>
      <table class="table table-bordered">
        <thead>
        <tr>
          <th>Course Code</th>
          <th>Exam Date</th>
          <th>Exam Time</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="entry : ${app.examEntries}">
          <td th:text="${entry.courseCode}"></td>
          <td th:text="${entry.examDate}"></td>
          <td th:text="${entry.examTime}"></td>
        </tr>
        </tbody>
      </table>
    </div>

    <div class="mt-4">
      <h5 class="section-heading">Student Info</h5>
      <p><strong>Name:</strong> <span th:text="${student.firstName + ' ' + student.lastName}"></span></p>
      <p><strong>Student ID:</strong> <span th:text="${student.studentId}"></span></p>
      <p><strong>Email:</strong> <span th:text="${student.email}"></span></p>
      <p><strong>Phone:</strong> <span th:text="${student.phoneNumber}"></span></p>
      <p><strong>Address:</strong> <span th:text="${student.address}"></span></p>
      <p><strong>Campus:</strong> <span th:text="${app.campus}"></span></p>
      <p><strong>Semester/Year:</strong> <span th:text="${app.semesterYear}"></span></p>
    </div>

    <div class="mt-4">
      <h5 class="section-heading">Attached Documents</h5>
      <ul id="documentList"></ul>
      <button id="downloadAllBtn" class="btn btn-primary mt-3">Download All</button>
    </div>

    <div class="mt-4">
      <h5 class="section-heading">Student Signature</h5>
      <canvas id="signatureCanvas"></canvas>
    </div>

    <!-- Admin Actions -->
    <div class="mt-4">
      <h5 class="section-heading">Admin Actions</h5>
      <div th:if="${app.status.name() == 'PENDING'}" class="mb-3 d-flex flex-wrap gap-3">
        <form th:action="@{/admin/updateOtherApplicationStatus}" method="post" class="d-flex gap-2">
          <input type="hidden" name="applicationId" th:value="${app.id}" />
          <select name="status" class="form-select w-auto">
            <option value="APPROVED">Approve</option>
            <option value="REJECTED">Reject</option>
          </select>
          <button type="submit" class="btn btn-primary">Update Status</button>
        </form>
        <form th:action="@{/admin/deleteCompassionateApplication}" method="post">
          <input type="hidden" name="applicationId" th:value="${app.id}" />
          <button type="submit" class="btn btn-danger">Delete Application</button>
        </form>
      </div>

      <div th:if="${app.status.name() != 'PENDING'}">
        <div class="alert alert-info">
          Status is <strong th:text="${app.status}"></strong>. No further admin actions available.
        </div>
      </div>
    </div>

  </div>
</div>

<script th:inline="javascript">
  window.applicationFilePaths = /*[[${app.documentPaths}]]*/ [];
  window.signaturePath = /*[[${app.studentSignatureFilePath}]]*/ "";
</script>
<script th:src="@{/scripts/application-view.js}"></script>
</body>
</html>
