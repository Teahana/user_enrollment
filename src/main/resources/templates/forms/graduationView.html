<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>View Graduation Application</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" th:href="@{/styles/navbar.css}">
    <link rel="stylesheet" th:href="@{/styles/main.css}">
</head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>
<div class="container">
    <div class="card animated-card p-4">
        <h2 class="section-heading">Submitted Graduation Application</h2>

        <fieldset class="mb-4">
            <legend class="section-heading">Section A: Personal Details</legend>
            <p><strong>Student ID:</strong> <span th:text="${app.student.studentId}"></span></p>
            <p><strong>First Name:</strong> <span th:text="${app.student.firstName}"></span></p>
            <p><strong>Surname:</strong> <span th:text="${app.student.lastName}"></span></p>
            <p><strong>Date of Birth:</strong> <span th:text="${app.dateOfBirth}"></span></p>
            <p><strong>Email:</strong> <span th:text="${app.student.email}"></span></p>
            <p><strong>Phone:</strong> <span th:text="${app.student.phoneNumber}"></span></p>
            <p><strong>Address:</strong> <span th:text="${app.student.address}"></span></p>
            <p><strong>Programme:</strong> <span th:text="${app.programme.name}"></span></p>
            <p><strong>Major 1:</strong> <span th:text="${app.major1}"></span></p>
            <p><strong>Major 2:</strong> <span th:text="${app.major2}"></span></p>
            <p><strong>Minor:</strong> <span th:text="${app.minor}"></span></p>
        </fieldset>

        <fieldset class="mb-4">
            <legend class="section-heading">Section B: Graduation Ceremony</legend>
            <p><strong>Preferred Ceremony:</strong> <span th:text="${app.ceremonyPreference}"></span></p>
            <p><strong>Other Campus:</strong> <span th:text="${app.otherCampus}"></span></p>
        </fieldset>

        <fieldset class="mb-4">
            <legend class="section-heading">Section C: Attendance</legend>
            <p><strong>Will Attend:</strong> <span th:text="${app.willAttend ? 'Yes' : 'No'}"></span></p>
        </fieldset>

        <fieldset>
            <legend class="section-heading">Section D: Declaration</legend>
            <p><strong>Date:</strong> <span th:text="${app.signatureDate}"></span></p>
            <p><strong>Signature:</strong></p>
            <canvas id="signatureCanvas"></canvas>
        </fieldset>

        <!-- Admin Actions -->
        <div class="mt-4">
            <h5 class="section-heading">Admin Actions</h5>
            <div th:if="${app.status.name() == 'PENDING'}" class="mb-3 d-flex flex-wrap gap-3">
                <form th:action="@{/admin/updateApplicationStatus}" method="post" class="d-flex gap-2">
                    <input type="hidden" name="applicationId" th:value="${app.id}" />
                    <select name="status" class="form-select w-auto">
                        <option value="APPROVED">Approve</option>
                        <option value="REJECTED">Reject</option>
                    </select>
                    <button type="submit" class="btn btn-primary">Update Status</button>
                </form>
                <form th:action="@{/admin/deleteGraduationApplication}" method="post">
                    <input type="hidden" name="applicationId" th:value="${app.id}" />
                    <button type="submit" class="btn btn-danger">Delete Application</button>
                </form>
            </div>

            <div th:if="${app.status.name() != 'PENDING'}">
                <div class="alert alert-info">
                    Status is <strong th:text="${app.status}"></strong>. No further admin actions available.
                </div>
            </div>
        </div>

    </div>
</div>

<script th:inline="javascript">
    window.signaturePath = /*[[${app.studentSignatureFilePath}]]*/ "";
</script>
<script th:src="@{/scripts/application-view.js}"></script>
</body>
</html>
